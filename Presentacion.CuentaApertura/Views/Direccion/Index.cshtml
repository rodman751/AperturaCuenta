@{
    ViewData["Title"] = "Paso 3: Direccion";
}
@model Modelos.DireccionMapa
<!DOCTYPE html>
<html style="font-size: 16px;" lang="es">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="​Book an Appointment">
    <meta name="description" content="">
    <title>Page_2</title>
    <link rel="stylesheet" href="./css/nicepage.css" media="screen">
    <link rel="stylesheet" href="./css/Page_2.css" media="screen">
    <meta name="generator" content="Nicepage 6.14.4, nicepage.com">
    <meta name="referrer" content="origin">
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,500,500i,600,600i,700,700i,800,800i">
    <link id="u-page-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i">
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="Page_2">
    <meta property="og:type" content="website">
    <meta data-intl-tel-input-cdn-path="intlTelInput/">

    

</head>
<body data-path-to-root="./" data-include-products="false" class="u-body u-xl-mode" data-lang="es">
    
    <section class="u-align-center u-clearfix u-custom-color-2 u-section-1" id="carousel_ac2e">
        <div class="u-clearfix u-sheet u-sheet-1">
            <div class="u-align-center u-container-style u-custom-color-3 u-expanded-width-xs u-group u-radius-20 u-shape-round u-group-1">
                <div class="u-container-layout u-container-layout-1" style="margin-bottom: 150px;">
                    <img class="custom-expanded u-image u-image-default u-image-1" src="images/asd.png" alt="" data-image-width="623" data-image-height="476">
                    <h3 class="u-text u-text-1">
                        <br>Apertura <span style="font-weight: 700;">
                            <span style="font-weight: 400;">
                                <span style="font-weight: 700;"></span>
                            </span>
                        </span>tu cuenta
                    </h3>
                    <div class="u-form u-form-1" id="carousel-fa54">
                        <form asp-action="GuardarDireccionMCookie" asp-controller="Steps" method="post" class="u-clearfix u-form-spacing-9 u-form-vertical u-inner-form" style="padding: 22px;">
                            <div class="u-border-1 u-border-palette-2-light-3 u-form-group u-form-line u-label-top u-line u-line-horizontal u-line-1"></div>

                            <div class="u-form-group u-form-name u-form-partition-factor-2 u-label-top u-form-group-2">
                                <label class="u-label u-label-1">Nombre</label>
                                <input type="text" placeholder="Ingrese su nombre" class="u-border-2 u-border-white u-input u-input-rectangle u-radius u-text-grey-80 u-input-1" required
                                       value="@ViewBag.Usuario" readonly />
                                <span class="text-danger"></span>
                            </div>

                            <div class="u-form-group u-form-name u-form-partition-factor-2 u-label-top u-form-group-3">
                                <label class="u-label u-label-2">Apellido</label>
                                <input type="text" placeholder="Ingrese su apellido" class="u-border-2 u-border-white u-input u-input-rectangle u-radius u-text-grey-80 u-input-2" required
                                       value="@ViewBag.Apellido" readonly />
                                <span class="text-danger"></span>
                            </div>


                            <div class="u-border-1 u-border-palette-2-light-3 u-form-group u-form-line u-label-top u-line u-line-horizontal u-line-2"></div>

                            <div class="u-form-group u-label-top u-form-group-8">
                                <label asp-for="Direccion" class="u-label u-label-6">Dirección:</label>
                                <input asp-for="Direccion" type="text" placeholder="av.***, Ciudad" class="u-border-2 u-border-white u-input u-input-rectangle u-radius u-text-grey-80 u-input-6" oninput="this.value = this.value.replace(/[^a-zA-ZñÑ\s]/g, '');" maxlength="17" required />
                                <span asp-validation-for="Direccion" class="text-danger"></span>
                            </div>

                            <!-- Provincias -->
                            <div class="u-form-group u-form-text u-label-top u-form-group-5">
                                <label asp-for="Provincia" class="u-label u-label-3">Provincias</label>
                                <input asp-for="Provincia" class="u-border-2 u-border-white u-input u-input-rectangle u-radius u-text-grey-80 u-input-3" type="text" oninput="this.value = this.value.replace(/[^a-zA-ZñÑ\s]/g, '');" maxlength="17" required>
                                <div id="provincia-suggestions" class="suggestions"></div>
                                <span asp-validation-for="Provincia" class="text-danger"></span>
                            </div>

                            <!-- Cantones -->
                            <div class="u-form-group u-form-text u-label-top u-form-group-6">
                                <label asp-for="Canton" class="u-label u-label-4">Cantón:</label>
                                <input asp-for="Canton" class="u-border-2 u-border-white u-input u-input-rectangle u-radius u-text-grey-80 u-input-4" type="text" oninput="this.value = this.value.replace(/[^a-zA-ZñÑ\s]/g, '');" maxlength="17" required>
                                <div id="canton-suggestions" class="suggestions"></div>
                                <span asp-validation-for="Canton" class="text-danger"></span>
                            </div>

                            <!-- Parroquias -->
                            <div class="u-form-group u-form-text u-label-top u-form-group-7">
                                <label asp-for="Parroquia" class="u-label u-label-5">Parroquia:</label>
                                <input asp-for="Parroquia" class="u-border-2 u-border-white u-input u-input-rectangle u-radius u-text-grey-80 u-input-5" oninput="this.value = this.value.replace(/[^a-zA-ZñÑ\s]/g, '');" maxlength="17" required>
                                <div id="parroquia-suggestions" class="suggestions"></div>
                                <span asp-validation-for="Parroquia" class="text-danger"></span>
                            </div>



                           
                            <div class="u-form-group u-label-top u-form-group-9">
                                <label asp-for="Referencia" class="u-label u-label-7">Referencia</label>
                                <input asp-for="Referencia" type="text" placeholder="" class="u-border-2 u-border-white u-input u-input-rectangle u-radius u-text-grey-80 u-input-7" oninput="this.value = this.value.replace(/[^a-zA-ZñÑ\s]/g, '');" maxlength="20" required />
                                <span asp-validation-for="Referencia" class="text-danger"></span>
                            </div>

                            <div class="u-border-1 u-border-palette-2-light-3 u-form-group u-form-line u-label-top u-line u-line-horizontal u-line-3"></div>

                            <div class="u-align-left u-form-group u-form-submit u-label-top">
                                <button type="submit" class="u-border-none u-btn u-btn-round u-btn-submit u-button-style u-custom-color-5 u-custom-font u-font-montserrat u-radius-20 u-btn-1">CONTINUAR</button>
                            </div>

                            <div class="u-form-send-message u-form-send-success">Thank you! Your message has been sent.</div>
                            <div class="u-form-send-error u-form-send-message">Unable to send your message. Please fix errors then try again.</div>

                            <input type="hidden" value="" name="recaptchaResponse">
                            <input type="hidden" name="formServices" value="9d5de5cf-c74d-2673-4c36-3c5014c4e60a">
                        </form>

                    </div>
                    <div class="u-grey-light-2 u-map u-map-1">
                        <div class="embed-responsive">
                            <div id="map" style="height: 350px; width: 100%;"></div>
                           
                        </div>
                    </div>

                    

                </div>
            </div>
        </div>
    </section>


    <!-- Modal 1: No usar gorras, lentes y levantar el pelo -->
    <div id="modal1" class="modal">
        <div class="modal-content">

            <p>Puedes agregar tu dirección, o para mayor precisión, usa el puntero rojo del mapa 📍</p>

            <button class="close btn btn-primary btn-sm" id="closeModal1">Continuar</button>
        </div>
    </div>
    <link href="~/css/Modals.css" rel="stylesheet" />
   
    @section Scripts{
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBJ0pLsT4Ra598n5FNXGLBfrts2PW-fTP8&libraries=places&callback=initMap"></script>
        <script>
            let map, marker, geocoder, autocomplete;

            function initMap() {
                try {
                    geocoder = new google.maps.Geocoder();

                    map = new google.maps.Map(document.getElementById('map'), {
                        center: { lat: -0.231, lng: -78.524 }, // Coordenadas iniciales
                        zoom: 12
                    });

                    marker = new google.maps.Marker({
                        position: map.getCenter(),
                        map: map,
                        draggable: true
                    });

                    autocomplete = new google.maps.places.Autocomplete(document.getElementById('Direccion'), {
                        types: ['geocode']
                    });

                    autocomplete.addListener('place_changed', onPlaceChanged);

                    google.maps.event.addListener(marker, 'dragend', function () {
                        geocodePosition(marker.getPosition());
                    });
                } catch (error) {
                    console.error('Error initializing Google Maps:', error);
                }
            }

            function onPlaceChanged() {
                const place = autocomplete.getPlace();

                if (!place.geometry) {
                    return;
                }

                // Actualiza el mapa a la ubicación seleccionada
                map.setCenter(place.geometry.location);
                map.setZoom(17);
                marker.setPosition(place.geometry.location);

                // Actualiza los campos según la dirección seleccionada
                place.address_components.forEach(function (component) {
                    const types = component.types;
                    if (types.includes('administrative_area_level_1')) {
                        document.getElementById('Provincia').value = component.long_name;
                    } else if (types.includes('locality')) {
                        document.getElementById('Canton').value = component.long_name;
                    } else if (types.includes('sublocality_level_1')) {
                        document.getElementById('Parroquia').value = component.long_name;
                    } else if (types.includes('street_address') || types.includes('route')) {
                        document.getElementById('Direccion').value = component.long_name;
                    }
                });
            }

            function geocodePosition(position) {
                geocoder.geocode({ latLng: position }, function (results, status) {
                    if (status === google.maps.GeocoderStatus.OK && results[0]) {
                        const address = results[0].formatted_address;
                        document.getElementById('Direccion').value = address;

                        results[0].address_components.forEach(function (component) {
                            const types = component.types;
                            if (types.includes('administrative_area_level_1')) {
                                document.getElementById('Provincia').value = component.long_name;
                            } else if (types.includes('locality')) {
                                document.getElementById('Canton').value = component.long_name;
                            } else if (types.includes('sublocality_level_1')) {
                                document.getElementById('Parroquia').value = component.long_name;
                            }
                        });
                    }
                });
            }

            const Provincias = ["Azuay", "Bolívar", "Cañar", "Carchi", "Chimborazo", "Cotopaxi", "El Oro", "Esmeraldas", "Galápagos", "Guayas", "Imbabura", "Loja", "Los Ríos", "Manabí", "Morona Santiago", "Napo", "Orellana", "Pastaza", "Pichincha", "Santa Elena", "Santa Isabel", "Santo Domingo de los Tsáchilas", "Sucumbíos", "Tungurahua", "Zamora-Chinchipe"];

            const Cantones = ["Cuenca", "Azogues", "Riobamba", "Loja", "Guayaquil", "Quito", "Ambato", "Manta", "Machala", "Esmeraldas", "Ibarra", "Santa Elena", "Portoviejo", "Santo Domingo"];

            const Parroquias = ["El Sagrario", "La Libertad", "San Blas", "La Merced", "San Sebastián", "San Francisco", "San Pedro"];

            function setupAutocomplete(inputId, suggestionsId, dataList) {
                const input = document.getElementById(inputId);
                const suggestionsBox = document.getElementById(suggestionsId);

                input.addEventListener('input', function () {
                    const query = this.value.toLowerCase();
                    suggestionsBox.innerHTML = ''; // Limpia las sugerencias anteriores

                    if (query) {
                        const filtered = dataList.filter(item => item.toLowerCase().includes(query));

                        filtered.forEach(item => {
                            const div = document.createElement('div');
                            div.textContent = item;
                            div.classList.add('suggestion-item');
                            div.addEventListener('click', function () {
                                input.value = item;
                                suggestionsBox.innerHTML = ''; // Limpia las sugerencias después de seleccionar
                            });
                            suggestionsBox.appendChild(div);
                        });

                        if (filtered.length === 0) {
                            suggestionsBox.innerHTML = '<div>No hay sugerencias</div>';
                        }
                    }
                });
            }

            // Configura el autocompletado para cada campo
            setupAutocomplete('Provincia', 'provincia-suggestions', Provincias);
            setupAutocomplete('Canton', 'canton-suggestions', Cantones);
            setupAutocomplete('Parroquia', 'parroquia-suggestions', Parroquias);

            // Estilos para las sugerencias
            document.head.insertAdjacentHTML('beforeend', `
                        <style>
                            .suggestions {
                                border: 1px solid #ddd;
                                max-height: 150px;
                                overflow-y: auto;
                                position: absolute;
                                background-color: white;
                                z-index: 1000;
                                border-radius: 8px;
                                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                                font-family: 'Roboto', sans-serif;
                            }
                            .suggestion-item {
                                color: #333;
                                padding: 12px;
                                cursor: pointer;
                                transition: background-color 0.3s ease, color 0.3s ease;
                                font-family: 'Montserrat', sans-serif;
                            }
                            .suggestion-item:hover {
                                background-color: #e0e0e0;
                                color: #007bff;
                            }
                        </style>
                    `);


            document.addEventListener('DOMContentLoaded', function () {
                var modal1 = document.getElementById('modal1');
               

                // Mostrar el primer modal
                setTimeout(function () {
                    modal1.style.display = 'block';
                }, 2000);
                setTimeout(function () {
                    modal1.style.display = 'none';
                }, 7000);

                document.getElementById('closeModal1').onclick = function () {
                    modal1.style.display = 'none';
                }
                // Cerrar el modal si se hace clic fuera de él
                window.onclick = function (event) {
                    if (event.target == modal1) {
                        modal1.style.display = 'none';
                    }
                    
                }
            });
        </script>



    }
</body>
</html>